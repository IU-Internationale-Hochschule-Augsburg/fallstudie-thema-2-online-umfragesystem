<!-- Add-question-screen -->
<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link th:href="@{/survey.css}" th:rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
          rel="stylesheet">

    <!-- <link rel="stylesheet" href="../static/survey.css"> -->

    <title>Frage hinzufügen</title>
</head>

<body>
<!-- Page title -->
<div class="header">
    <h3>Neue Frage erstellen</h3>
</div>

<div class="content" style="flex-direction: column">

    <!-- Input field and label for the question -->
    <form style="width: 100%" id="myForm" action="#" th:action="@{/question-save}" th:object="${addQuestion}" method="post">
        <div class="formularreihe">
            <div class="col-25">
                <label for="questionText">Bezeichnung Frage:</label>
            </div>
            <div class="col-75">
                <input type="text" th:field="*{questionText}" placeholder="Frage eingeben" class="textfeld" id="questionText" autofocus maxlength="256" required> <!-- required> -->
            </div>
        </div>

        <!-- Three radiobuttons for selecting the question type -->
        <div class="containerFlex" style="margin-bottom: 10px; justify-content: space-between">
            <!-- Radiobuttons for question type -->
            <div style="width: auto" class="formularreihe">
                <label class="container">Radiobutton
                    <input type="radio" name="fragentyp" value="radiobutton" onchange="updateQuestionType(this.value)" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="container">Checkbox
                    <input type="radio" name="fragentyp" value="checkbox" onchange="updateQuestionType(this.value)">
                    <span class="checkmark"></span>
                </label>
                <label class="container">Freitext
                    <input type="radio" name="fragentyp" value="open text response" onchange="updateQuestionType(this.value)">
                    <span class="checkmark"></span>
                </label>
                <!--<input type="text" id="questionType" th:value="${questionType}">-->
                <input type="hidden" id="questionType" th:field="*{questionType}" th:value="*{questionType}" readonly>
            </div>

            <!-- Button for adding an answer -->
            <div>
                <button type="button" class="formularabsenden" id="addAnswerButton" style="display: none;" onclick="addAnswerOption()">+ Antwort</button> <!-- class="formularabsenden" -->
            </div>
        </div>
        <p style="border-bottom: solid 1px black; margin: 0"></p>

        <!-- Answer options template-->
        <div id="answerOptionTemplate" style="display: none;">
            <div class="containerFlex answerOption" style="border-bottom: solid 1px black; padding-top: 2px; padding-bottom: 2px; padding-left: 10px">
                <label style="width: 25%; display: flex; align-items: center">Antwortoption </label>

                <!-- Input field -->
                <div style="display: flex; align-items: center;width: 65%;">
                    <input class="textfeld" style="padding: 12px;height: 42px;" type="text" id="antwort"
                           placeholder="Antwortoption eingeben" maxlength="256" required> <!--required> -->
                </div>

                <!-- Delete button -->
                <div style="width: 10%; text-align: right">
                    <button class="optbutton" onclick="deleteAnswerOption(this)">
                        <span class="material-symbols-outlined">delete</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="answerOptions">
            <!--answer option 1 - default answer option -->
            <div id="answerOption1" class="answerOption">
                <script type="application/javascript">
                    function addDefaultAnswerOption() {
                        // Hier wird die Antwortoption hinzugefügt
                        var defaultAnswerOption = document.createElement('div');
                        defaultAnswerOption.classList.add('containerFlex', 'answerOption');
                        defaultAnswerOption.innerHTML = `
                            <label style="width: 25%; display: flex; align-items: center" for="antwort">Antwortoption 1</label>
                            <div style="display: flex; align-items: center;width: 65%;">
                                <input class="textfeld" style="padding: 12px;height: 42px;" type="text" id="antwort" placeholder="Antwort" maxlength="256" required>
                            </div>
                            <div style="width: 10%; text-align: right">
                                <button class="optbutton" onclick="deleteAnswerOption(this)">
                                    <span class="material-symbols-outlined">delete</span>
                                </button>
                            </div>
                        `;
                        document.getElementById('answerOptions').appendChild(defaultAnswerOption);
                    }
                </script>
            </div>
        </div>
    </form>
</div>

<!-- Cancel and Save buttons -->
<div class="footer">
    <button type="button" class="formularabsenden" onclick="goBack()">Abbrechen</button>

    <button form="myForm" type="submit" class="formularabsenden">Speichern</button>
</div>

<script type="application/javascript">
    // function to hide the +Answer button and remember the question types
    // function to prepopulate the input fields with 'radiobutton'
    window.onload = function() {
        updateQuestionType('radiobutton');
    }

    // function for the cancel button
    function goBack() {
        window.history.back();
    }

    function updateQuestionType(qType) {
        // to remember radio buttons by default
        var addAnswerButton = document.getElementById('addAnswerButton');
        var answerOptionsDiv = document.getElementById('answerOptions');

        var selectedRadiobutton = document.querySelector('input[type=radio]:checked').value;
        document.getElementById('questionType').value = selectedRadiobutton;

        // hide the +Answer button if the type is free text. Otherwise, by default, display one answer option
        if(qType === 'radiobutton' || qType === 'checkbox') {
            addAnswerButton.style.display = 'block';

            if(answerCount === 0) {
                answerCount = 1;
            }
        } else {
            addAnswerButton.style.display = 'none';
            while(answerOptionsDiv.firstChild) {
                answerOptionsDiv.removeChild(answerOptionsDiv.firstChild);
            }
            answerCount = 0;
        }
    }

    var answerCount = 1;

    // function to add an answer option; the function copies the answer options template
    function addAnswerOption() {
        debugger;
        // if-clause to limit the number of options that can be added. You can create a maximum of 10 options
        if(answerCount < 11) {
            // clone the answer options template
            var tempElement = document.getElementById('answerOptionTemplate');
            var temp = tempElement.cloneNode(true);
            temp.id = 'answerOption' + answerCount;
            temp.style.display = 'block';

            // change label
            var label = temp.querySelector('label');
            label.innerText = 'Antwortoption ' + answerCount + ' ';
            document.getElementById('answerOptions').appendChild(temp);

            answerCount++;
        }
    }

    // function to delete the selected answer option
    function deleteAnswerOption(button) {
        // if clause to limit the delete function
        if (answerCount > 1) {
            var answerDiv = button.parentElement.parentElement;
            answerDiv.remove();
            answerCount--;
        }
    }
</script>

</body>
</html>